<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central Women's University - Class Attendance Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better aesthetics */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            color: #334155; /* Darker text */
        }
        .container {
            max-width: 1200px;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1rem; /* More rounded corners */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Subtle shadow */
        }
        /* Department Red Accent */
        .btn-primary {
            background-color: #dc2626; /* Red-600 */
            color: white;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #b91c1c; /* Red-700 on hover */
        }
        .btn-secondary {
            background-color: #6b7280; /* Gray */
            color: white;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            transition: background-color 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #4b5563; /* Darker gray on hover */
        }
        input[type="text"], input[type="date"], input[type="time"], input[type="number"], select, textarea, input[type="password"] {
            border-radius: 0.5rem;
            border: 1px solid #d1d5db; /* Light gray border */
            padding: 0.75rem 1rem;
            width: 100%;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        input[type="text"]:focus, input[type="date"]:focus, input[type="time"]:focus, input[type="number"]:focus, select:focus, textarea:focus, input[type="password"]:focus {
            border-color: #dc2626; /* Red focus border */
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2); /* Light red shadow on focus */
            outline: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb; /* Lighter gray border */
        }
        th {
            background-color: #fee2e2; /* Light red header */
            font-weight: 600;
            color: #991b1b; /* Darker red text */
        }
        tr:hover {
            background-color: #fef2f2; /* Very light red on row hover */
        }
        /* Navigation Styles */
        .nav-menu-item {
            position: relative;
        }
        .nav-menu-button {
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s ease, color 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
            color: #334155;
        }
        .nav-menu-button:hover {
            background-color: #fee2e2;
            color: #dc2626;
        }
        .nav-menu-button.active {
            background-color: #dc2626;
            color: white;
        }
        .submenu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            min-width: 180px;
            z-index: 100;
            padding: 0.5rem 0;
        }
        .submenu.active {
            display: block;
        }
        .submenu-item {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.3s ease, color 0.3s ease;
            color: #334155;
        }
        .submenu-item:hover {
            background-color: #fee2e2;
            color: #dc2626;
        }
        .submenu-item.active {
            background-color: #fef2f2; /* Lighter red for active sub-item */
            color: #dc2626;
            font-weight: 600;
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            display: none; /* Hidden by default */
        }
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none; /* Hidden by default */
        }
        .print-section {
            display: none; /* Hidden by default for screen */
        }
        @media print {
            body > *:not(.print-section) {
                display: none !important; /* Hide everything except the print section */
            }
            .print-section {
                display: block !important;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: auto;
                background: white;
                padding: 20px;
                box-shadow: none;
            }
            .print-section h1, .print-section h2, .print-section h3 {
                color: #000 !important;
            }
            .print-section table {
                width: 100%;
                border-collapse: collapse;
            }
            .print-section th, .print-section td {
                border: 1px solid #ccc;
                padding: 8px;
            }
            .print-section th {
                background-color: #f2f2f2;
            }
        }

        /* Modal specific styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 600px;
            max-height: 90vh; /* Limit height for scrollability */
            overflow-y: auto;
        }

        /* Drag and Drop Specific Styles */
        .draggable-course {
            cursor: grab;
            background-color: #fef2f2; /* Light red */
            border: 1px solid #dc2626; /* Red border */
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
            color: #991b1b; /* Dark red text */
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
        }
        .draggable-course:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .draggable-course.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .routine-grid-container {
            overflow-x: auto;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        .routine-grid {
            min-width: 800px; /* Ensure table doesn't shrink too much */
            border-collapse: collapse;
        }
        .routine-grid th, .routine-grid td {
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            text-align: center;
            vertical-align: top;
            height: 60px; /* Fixed height for time slots */
        }
        .routine-grid th {
            background-color: #fee2e2;
            font-weight: 600;
            color: #991b1b;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .routine-grid td {
            background-color: #ffffff;
        }
        .routine-grid td.time-slot-header {
            background-color: #fef2f2;
            font-weight: 500;
            color: #dc2626;
            position: sticky;
            left: 0;
            z-index: 10;
        }
        .drop-target.drag-over {
            background-color: #fce7f3; /* Light pink on drag over */
            border: 2px dashed #db2777; /* Pink dashed border */
        }
        .routine-item {
            background-color: #ef4444; /* Red-500 */
            color: white;
            border-radius: 0.5rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem; /* text-xs */
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .routine-item .delete-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
            padding: 0 0.25rem;
        }
        .routine-item .delete-btn:hover {
            color: #fca5a5; /* Red-300 */
        }

        .clash-report {
            background-color: #fef2f2;
            border: 1px solid #ef4444;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1.5rem;
        }
        .clash-report h3 {
            color: #dc2626;
            margin-bottom: 0.75rem;
        }
        .clash-report ul {
            list-style: disc;
            padding-left: 1.25rem;
        }
        .clash-report li {
            margin-bottom: 0.5rem;
            color: #b91c1c;
        }
        .clash-report li.solution {
            color: #16a34a; /* Green for solutions */
            font-weight: 500;
        }

        /* Tabs for Add/Remove Section */
        .tab-buttons {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
        .tab-button {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .tab-button:hover {
            color: #dc2626;
        }
        .tab-button.active {
            color: #dc2626;
            border-bottom-color: #dc2626;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="loginSection" class="flex items-center justify-center min-h-screen bg-gray-100">
        <div class="card p-8 w-full max-w-md">
            <h2 class="text-3xl font-bold text-center text-red-700 mb-6">Login</h2>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label for="username" class="block text-gray-700 text-sm font-bold mb-2">Username:</label>
                    <input type="text" id="username" name="username" required class="focus:ring-red-500 focus:border-red-500">
                </div>
                <div>
                    <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Password:</label>
                    <input type="password" id="password" name="password" required class="focus:ring-red-500 focus:border-red-500">
                </div>
                <button type="submit" class="btn-primary w-full">Login</button>
                <p id="loginError" class="text-red-500 text-center text-sm mt-2 hidden">Invalid username or password.</p>
            </form>
        </div>
    </div>

    <div id="mainContent" class="container mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-10 hidden">
        <h1 class="text-4xl font-extrabold text-center text-red-800 mb-2">Central Women's University</h1>
        <h2 class="text-2xl font-bold text-center text-red-600 mb-8">Department of English Language and Literature</h2>

        <nav class="mb-8 flex flex-wrap justify-center gap-2">
            <div class="nav-menu-item">
                <button class="nav-menu-button" id="navHomeButton">Home</button>
            </div>
            <div class="nav-menu-item">
                <button class="nav-menu-button" data-target="academicManagementSubmenu">Academic Management</button>
                <div id="academicManagementSubmenu" class="submenu">
                    <div id="navCourses" class="submenu-item">Courses</div>
                    <div id="navStudents" class="submenu-item">Students</div>
                    <div id="navTeachers" class="submenu-item">Teachers</div>
                    <div id="navCourseOfferings" class="submenu-item">Course Offerings</div>
                </div>
            </div>

            <div class="nav-menu-item">
                <button class="nav-menu-button" data-target="classCalendarSubmenu">Class & Calendar</button>
                <div id="classCalendarSubmenu" class="submenu">
                    <div id="navRoutine" class="submenu-item">Routine</div>
                    <div id="navAttendance" class="submenu-item">Attendance Sheet</div>
                    <div id="navHolidays" class="submenu-item">Holidays & Events</div>
                    <div id="navAcademicCalendar" class="submenu-item">Academic Calendar</div>
                </div>
            </div>

            <div class="nav-menu-item">
                <button class="nav-menu-button" data-target="myToolsSubmenu">Tools</button>
                <div id="myToolsSubmenu" class="submenu">
                    <div id="navAddRemove" class="submenu-item">Add/Remove</div>
                    <div id="navDragDropRoutine" class="submenu-item">Routine Maker</div>
                </div>
            </div>
            <div class="nav-menu-item">
                <button class="nav-menu-button" id="logoutButton">Logout</button>
            </div>
        </nav>

        <div id="messageBoxOverlay" class="message-box-overlay"></div>
        <div id="messageBox" class="message-box">
            <p id="messageBoxText" class="text-lg mb-4"></p>
            <button id="messageBoxClose" class="btn-primary">OK</button>
        </div>

        <div id="loadingIndicator" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[1001]">
            <div class="bg-white p-6 rounded-lg shadow-lg flex items-center space-x-3">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"></div>
                <p class="text-lg text-gray-700">Loading data...</p>
            </div>
        </div>

        <section id="homeSection" class="content-section">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Home</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Today's Events</h3>
                    <div id="todayEventsList" class="space-y-2">
                        <p class="text-gray-500">No events scheduled for today.</p>
                    </div>
                </div>
                <div class="card p-6">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Upcoming Events (Next 7 Days)</h3>
                    <div id="upcomingEventsList" class="space-y-2">
                        <p class="text-gray-500">No upcoming events.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="addRemoveSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Add/Remove Data</h2>

            <div class="card p-6">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="coursesOfferings">Courses & Offerings</button>
                    <button class="tab-button" data-tab="people">People (Students & Teachers)</button>
                    <button class="tab-button" data-tab="calendarEvents">Calendar Events (Routine, Holidays, Agendas)</button>
                </div>

                <div id="coursesOfferingsTab" class="tab-content active">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="courseFormTitle">Add New Course to Curriculum</h3>
                    <form id="addCourseForm" class="space-y-4 mb-8">
                        <div>
                            <label for="courseName" class="block text-gray-700 text-sm font-bold mb-2">Course Name:</label>
                            <input type="text" id="courseName" name="courseName" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="courseCode" class="block text-gray-700 text-sm font-bold mb-2">Course Code:</label>
                            <input type="text" id="courseCode" name="courseCode" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="courseSemester" class="block text-gray-700 text-sm font-bold mb-2">Default Semester (e.g., 1st Semester):</label>
                            <input type="text" id="courseSemester" name="courseSemester" placeholder="e.g., Spring 2025" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="courseFaculty" class="block text-gray-700 text-sm font-bold mb-2">Default Faculty (Teacher):</label>
                            <select id="courseFaculty" name="courseFaculty" class="focus:ring-red-500 focus:border-red-500" required>
                                <option value="">-- Select Faculty --</option>
                            </select>
                        </div>
                        <div>
                            <label for="courseType" class="block text-gray-700 text-sm font-bold mb-2">Course Type:</label>
                            <select id="courseType" name="courseType" class="focus:ring-red-500 focus:border-red-500" required>
                                <option value="">-- Select Type --</option>
                                <option value="Core Course">Core Course</option>
                                <option value="GED">GED</option>
                            </select>
                        </div>
                        <div>
                            <label for="curriculumType" class="block text-gray-700 text-sm font-bold mb-2">Curriculum Type:</label>
                            <select id="curriculumType" name="curriculumType" class="focus:ring-red-500 focus:border-red-500" required>
                                <option value="">-- Select Curriculum --</option>
                                <option value="BA (Non-OBE)">BA (Non-OBE)</option>
                                <option value="BA (OBE)">BA (OBE)</option>
                                <option value="MA (Non-OBE)">MA (Non-OBE)</option>
                                <option value="MA (OBE)">MA (OBE)</option>
                                <option value="TESOL (OBE)">TESOL (OBE)</option>
                            </select>
                        </div>
                        <div>
                            <label for="offeredToSemester" class="block text-gray-700 text-sm font-bold mb-2">Offered to (Target Semester for Curriculum):</label>
                            <select id="offeredToSemester" name="offeredToSemester" class="focus:ring-red-500 focus:border-red-500" required>
                                <option value="">-- Select Semester --</option>
                                <option value="1st Semester">1st Semester</option>
                                <option value="2nd Semester">2nd Semester</option>
                                <option value="3rd Semester">3rd Semester</option>
                                <option value="4th Semester">4th Semester</option>
                                <option value="5th Semester">5th Semester</option>
                                <option value="6th Semester">6th Semester</option>
                                <option value="7th Semester">7th Semester</option>
                                <option value="8th Semester">8th Semester</option>
                            </select>
                        </div>
                        <div>
                            <label for="courseTiming" class="block text-gray-700 text-sm font-bold mb-2">Default Class Timing (e.g., Mon/Wed 10:00-11:30 AM):</label>
                            <input type="text" id="courseTiming" name="courseTiming" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="courseRoom" class="block text-gray-700 text-sm font-bold mb-2">Default Room Number:</label>
                            <input type="text" id="courseRoom" name="courseRoom" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <button type="submit" id="addUpdateCourseBtn" class="btn-primary w-full">Add Course to Curriculum</button>
                        <button type="button" id="cancelCourseEditBtn" class="btn-secondary w-full hidden">Cancel Edit</button>
                    </form>

                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Courses (in Curriculum)</h3>
                    <div id="coursesList" class="overflow-x-auto mb-8">
                        <p class="text-gray-500 text-center">No courses added yet.</p>
                    </div>
                    <button onclick="printSection('coursesList')" class="btn-secondary mt-6">Print Courses</button>

                    <hr class="my-8">

                    <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="courseOfferingFormTitle">Add Course Offering for Semester</h3>
                    <form id="addCourseOfferingForm" class="space-y-4 mb-8">
                        <div>
                            <label for="offeringSemester" class="block text-gray-700 text-sm font-bold mb-2">Semester for Offering (e.g., Spring 2025):</label>
                            <input type="text" id="offeringSemester" name="offeringSemester" placeholder="e.g., Spring 2025" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Select Courses from Curriculum for this Offering:</label>
                            <div id="availableCoursesForOffering" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 max-h-60 overflow-y-auto border p-4 rounded-md">
                                <p class="text-gray-500">No courses available. Add courses to curriculum first.</p>
                            </div>
                        </div>
                        <button type="submit" id="addUpdateOfferingBtn" class="btn-primary w-full">Add Course Offering</button>
                        <button type="button" id="cancelOfferingEditBtn" class="btn-secondary w-full hidden">Cancel Edit</button>
                    </form>

                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Course Offerings</h3>
                    <div id="courseOfferingsList" class="overflow-x-auto">
                        <p class="text-gray-500 text-center">No course offerings added yet.</p>
                    </div>
                    <button onclick="printSection('courseOfferingsList')" class="btn-secondary mt-6">Print Course Offerings</button>
                </div>

                <div id="peopleTab" class="tab-content">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="studentFormTitle">Add New Student</h3>
                    <form id="addStudentForm" class="space-y-4 mb-8">
                        <div>
                            <label for="studentName" class="block text-gray-700 text-sm font-bold mb-2">Student Name:</label>
                            <input type="text" id="studentName" name="studentName" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="studentId" class="block text-gray-700 text-sm font-bold mb-2">Student ID:</label>
                            <input type="text" id="studentId" name="studentId" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="studentAddress" class="block text-gray-700 text-sm font-bold mb-2">Address:</label>
                            <textarea id="studentAddress" name="studentAddress" rows="3" required class="focus:ring-red-500 focus:border-red-500"></textarea>
                        </div>
                        <button type="submit" id="addUpdateStudentBtn" class="btn-primary w-full">Add Student</button>
                        <button type="button" id="cancelStudentEditBtn" class="btn-secondary w-full hidden">Cancel Edit</button>
                    </form>

                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Registered Students</h3>
                    <div id="studentsList" class="overflow-x-auto mb-8">
                        <p class="text-gray-500 text-center">No students added yet.</p>
                    </div>
                    <button onclick="printSection('studentsList')" class="btn-secondary mt-6">Print Students</button>

                    <hr class="my-8">

                    <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="teacherFormTitle">Add New Teacher</h3>
                    <form id="addTeacherForm" class="space-y-4 mb-8">
                        <div>
                            <label for="teacherName" class="block text-gray-700 text-sm font-bold mb-2">Teacher Name:</label>
                            <input type="text" id="teacherName" name="teacherName" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="teacherInitials" class="block text-gray-700 text-sm font-bold mb-2">Initials:</label>
                            <input type="text" id="teacherInitials" name="teacherInitials" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="teacherType" class="block text-gray-700 text-sm font-bold mb-2">Teacher Type:</label>
                            <select id="teacherType" name="teacherType" class="focus:ring-red-500 focus:border-red-500" required>
                                <option value="">-- Select Type --</option>
                                <option value="Regular">Regular</option>
                                <option value="Adjunct">Adjunct</option>
                            </select>
                        </div>
                        <button type="submit" id="addUpdateTeacherBtn" class="btn-primary w-full">Add Teacher</button>
                        <button type="button" id="cancelTeacherEditBtn" class="btn-secondary w-full hidden">Cancel Edit</button>
                    </form>

                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Teachers</h3>
                    <div id="teachersList" class="overflow-x-auto">
                        <p class="text-gray-500 text-center">No teachers added yet.</p>
                    </div>
                    <button onclick="printSection('teachersList')" class="btn-secondary mt-6">Print Teachers</button>
                </div>

                <div id="calendarEventsTab" class="tab-content">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="routineFormTitle">Add Routine Entry</h3>
                    <form id="addRoutineForm" class="space-y-4 mb-8">
                        <div>
                            <label for="routineCourse" class="block text-gray-700 text-sm font-bold mb-2">Course:</label>
                            <select id="routineCourse" name="routineCourse" class="focus:ring-red-500 focus:border-red-500" required>
                                <option value="">-- Select Course --</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="routineDay" class="block text-gray-700 text-sm font-bold mb-2">Day:</label>
                                <select id="routineDay" name="routineDay" class="focus:ring-red-500 focus:border-red-500" required>
                                    <option value="">-- Select Day --</option>
                                    <option value="Sunday">Sunday</option>
                                    <option value="Monday">Monday</option>
                                    <option value="Tuesday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                    <option value="Saturday">Saturday</option>
                                </select>
                            </div>
                            <div>
                                <label for="routineStartTime" class="block text-gray-700 text-sm font-bold mb-2">Start Time:</label>
                                <input type="time" id="routineStartTime" name="routineStartTime" required class="focus:ring-red-500 focus:border-red-500">
                            </div>
                            <div>
                                <label for="routineEndTime" class="block text-gray-700 text-sm font-bold mb-2">End Time:</label>
                                <input type="time" id="routineEndTime" name="routineEndTime" required class="focus:ring-red-500 focus:border-red-500">
                            </div>
                        </div>
                        <div>
                            <label for="routineRoom" class="block text-gray-700 text-sm font-bold mb-2">Room Number:</label>
                            <input type="text" id="routineRoom" name="routineRoom" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <button type="submit" id="addUpdateRoutineBtn" class="btn-primary w-full">Add Routine Entry</button>
                        <button type="button" id="cancelRoutineEditBtn" class="btn-secondary w-full hidden">Cancel Edit</button>
                    </form>

                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Current Routine</h3>
                    <div id="routineList" class="overflow-x-auto mb-8">
                        <p class="text-gray-500 text-center">No routine entries added yet.</p>
                    </div>
                    <button onclick="printSection('routineList')" class="btn-secondary mt-6">Print Routine</button>

                    <hr class="my-8">

                    <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="holidayFormTitle">Add New Event</h3>
                    <form id="addHolidayForm" class="space-y-4 mb-8">
                        <div>
                            <label for="eventType" class="block text-gray-700 text-sm font-bold mb-2">Event Type:</label>
                            <select id="eventType" name="eventType" class="focus:ring-red-500 focus:border-red-500" required>
                                <option value="">-- Select Type --</option>
                                <option value="National Holiday">National Holiday</option>
                                <option value="University Closure">University Closure</option>
                                <option value="Teacher Absence">Teacher Absence</option>
                                <option value="Sick Leave">Sick Leave</option>
                                <option value="Make-up Class">Make-up Class</option>
                                <option value="Agenda">Agenda</option>
                                <option value="Reminder">Reminder</option>
                                <option value="ToDo">To-Do Item</option>
                            </select>
                        </div>
                        <div>
                            <label for="eventTitle" class="block text-gray-700 text-sm font-bold mb-2">Event Title:</label>
                            <input type="text" id="eventTitle" name="eventTitle" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="eventDate" class="block text-gray-700 text-sm font-bold mb-2">Date:</label>
                            <input type="date" id="eventDate" name="eventDate" required class="focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div>
                            <label for="eventDescription" class="block text-gray-700 text-sm font-bold mb-2">Description (Optional):</label>
                            <textarea id="eventDescription" name="eventDescription" rows="2" class="focus:ring-red-500 focus:border-red-500"></textarea>
                        </div>
                        <button type="submit" id="addUpdateHolidayBtn" class="btn-primary w-full">Add Event</button>
                        <button type="button" id="cancelHolidayEditBtn" class="btn-secondary w-full hidden">Cancel Edit</button>
                    </form>

                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Academic Calendar Events</h3>
                    <div id="holidaysList" class="overflow-x-auto">
                        <p class="text-gray-500 text-center">No events added yet.</p>
                    </div>
                    <button onclick="printSection('holidaysList')" class="btn-secondary mt-6">Print Events</button>
                </div>
            </div>
        </section>

        <section id="coursesSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Courses</h2>
            <div id="displayCoursesList" class="overflow-x-auto card p-6">
                <p class="text-gray-500 text-center">No courses to display.</p>
            </div>
            <button onclick="printSection('displayCoursesList')" class="btn-secondary mt-6">Print Displayed Courses</button>
        </section>

        <section id="studentsSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Students</h2>
            <div id="displayStudentsList" class="overflow-x-auto card p-6">
                <p class="text-gray-500 text-center">No students to display.</p>
            </div>
            <button onclick="printSection('displayStudentsList')" class="btn-secondary mt-6">Print Displayed Students</button>
        </section>

        <section id="teachersSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Teachers</h2>
            <div id="displayTeachersList" class="overflow-x-auto card p-6">
                <p class="text-gray-500 text-center">No teachers to display.</p>
            </div>
            <button onclick="printSection('displayTeachersList')" class="btn-secondary mt-6">Print Displayed Teachers</button>
        </section>

        <section id="courseOfferingsSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Course Offerings</h2>
            <div id="displayCourseOfferingsList" class="overflow-x-auto card p-6">
                <p class="text-gray-500 text-center">No course offerings to display.</p>
            </div>
            <button onclick="printSection('displayCourseOfferingsList')" class="btn-secondary mt-6">Print Displayed Course Offerings</button>
        </section>

        <section id="routineSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Class Routine</h2>
            <div id="displayRoutineList" class="overflow-x-auto card p-6">
                <p class="text-gray-500 text-center">No routine entries to display.</p>
            </div>
            <button onclick="printSection('displayRoutineList')" class="btn-secondary mt-6">Print Displayed Routine</button>
        </section>

        <section id="attendanceSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Attendance Sheet</h2>
            <div class="card p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="attendanceCourseSelect" class="block text-gray-700 text-sm font-bold mb-2">Select Course:</label>
                        <select id="attendanceCourseSelect" class="focus:ring-red-500 focus:border-red-500">
                            <option value="">-- Select Course --</option>
                        </select>
                    </div>
                    <div>
                        <label for="attendanceDate" class="block text-gray-700 text-sm font-bold mb-2">Date:</label>
                        <input type="date" id="attendanceDate" class="focus:ring-red-500 focus:border-red-500">
                    </div>
                </div>
                <button id="loadAttendanceBtn" class="btn-primary w-full">Load Attendance Sheet</button>
            </div>

            <div id="attendanceSheetDisplay" class="card p-6 hidden">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Attendance for <span id="attendanceCourseTitle"></span> on <span id="attendanceDateDisplay"></span></h3>
                <div id="attendanceTableContainer" class="overflow-x-auto mb-4">
                    <p class="text-gray-500 text-center">Select a course and date to load attendance.</p>
                </div>
                <button id="saveAttendanceBtn" class="btn-primary w-full mb-4">Save Attendance</button>
                <button onclick="printSection('attendanceSheetDisplay')" class="btn-secondary w-full">Print Attendance Sheet</button>
            </div>
        </section>

        <section id="holidaysSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Holidays & Events</h2>
            <div id="displayHolidaysList" class="overflow-x-auto card p-6">
                <p class="text-gray-500 text-center">No holidays or events to display.</p>
            </div>
            <button onclick="printSection('displayHolidaysList')" class="btn-secondary mt-6">Print Displayed Events</button>
        </section>

        <section id="academicCalendarSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Academic Calendar</h2>
            <div id="academicCalendarDisplay" class="card p-6">
                <p class="text-gray-500 text-center">Academic calendar content will be displayed here.</p>
            </div>
        </section>

        <section id="dragDropRoutineSection" class="content-section hidden">
            <h2 class="text-3xl font-bold text-red-700 mb-6">Routine Maker (Drag & Drop)</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card p-6 md:col-span-1">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Available Courses</h3>
                    <div id="dragCoursesList" class="max-h-96 overflow-y-auto border p-4 rounded-md bg-gray-50">
                        <p class="text-gray-500">No courses available for drag & drop. Add courses first.</p>
                    </div>
                </div>
                <div class="card p-6 md:col-span-2">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Drag & Drop Routine Grid</h3>
                    <div class="routine-grid-container">
                        <table id="dragDropRoutineGrid" class="routine-grid">
                            <thead>
                                <tr>
                                    <th>Time/Day</th>
                                    <th>Sunday</th>
                                    <th>Monday</th>
                                    <th>Tuesday</th>
                                    <th>Wednesday</th>
                                    <th>Thursday</th>
                                    <th>Friday</th>
                                    <th>Saturday</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                    <button id="saveRoutineGridBtn" class="btn-primary mt-6 w-full">Save Routine</button>
                    <div id="clashReport" class="clash-report hidden">
                        <h3>Clash Report</h3>
                        <ul id="clashReportList"></ul>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // --- Data Storage (In-memory for this single-file HTML) ---
        let courses = JSON.parse(localStorage.getItem('courses')) || [];
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let teachers = JSON.parse(localStorage.getItem('teachers')) || [];
        let courseOfferings = JSON.parse(localStorage.getItem('courseOfferings')) || [];
        let routineEntries = JSON.parse(localStorage.getItem('routineEntries')) || [];
        let holidaysEvents = JSON.parse(localStorage.getItem('holidaysEvents')) || [];
        let attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords')) || {}; // {courseId_date: {studentId: present/absent}}

        // --- Helper Functions ---

        /**
         * Displays a custom message box.
         * @param {string} message - The message to display.
         */
        function showMessageBox(message) {
            document.getElementById('messageBoxText').textContent = message;
            document.getElementById('messageBoxOverlay').style.display = 'block';
            document.getElementById('messageBox').style.display = 'block';
        }

        /**
         * Hides the custom message box.
         */
        function hideMessageBox() {
            document.getElementById('messageBoxOverlay').style.display = 'none';
            document.getElementById('messageBox').style.display = 'none';
        }

        /**
         * Shows the loading indicator.
         */
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
        }

        /**
         * Hides the loading indicator.
         */
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        /**
         * Prints the content of a specific section.
         * @param {string} sectionId - The ID of the section to print.
         */
        function printSection(sectionId) {
            const sectionToPrint = document.getElementById(sectionId);
            if (sectionToPrint) {
                // Create a temporary div to hold the content for printing
                const printContainer = document.createElement('div');
                printContainer.classList.add('print-section');
                printContainer.innerHTML = `
                    <h1 class="text-3xl font-bold text-center mb-4">Central Women's University</h1>
                    <h2 class="text-xl font-semibold text-center mb-6">Department of English Language and Literature</h2>
                    <h3 class="text-2xl font-bold mb-4">${sectionToPrint.previousElementSibling ? sectionToPrint.previousElementSibling.textContent : 'Report'}</h3>
                    ${sectionToPrint.innerHTML}
                `;
                document.body.appendChild(printContainer);
                window.print();
                document.body.removeChild(printContainer); // Remove the temporary div after printing
            } else {
                showMessageBox('Error: Section not found for printing.');
            }
        }

        /**
         * Saves data to localStorage.
         * @param {string} key - The key for localStorage.
         * @param {Array|Object} data - The data to save.
         */
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // --- Navigation Logic ---
        const contentSections = document.querySelectorAll('.content-section');
        const navButtons = document.querySelectorAll('.nav-menu-button');
        const submenuItems = document.querySelectorAll('.submenu-item');
        const submenus = document.querySelectorAll('.submenu');

        /**
         * Hides all content sections.
         */
        function hideAllSections() {
            contentSections.forEach(section => section.classList.add('hidden'));
        }

        /**
         * Hides all submenus.
         */
        function hideAllSubmenus() {
            submenus.forEach(submenu => submenu.classList.remove('active'));
        }

        /**
         * Removes active class from all navigation buttons.
         */
        function deactivateAllNavButtons() {
            navButtons.forEach(btn => btn.classList.remove('active'));
            submenuItems.forEach(item => item.classList.remove('active'));
        }

        /**
         * Displays a specific section and updates active navigation.
         * @param {string} sectionId - The ID of the section to display.
         * @param {HTMLElement} activeElement - The navigation element that was clicked.
         */
        function showSection(sectionId, activeElement) {
            hideAllSections();
            hideAllSubmenus();
            deactivateAllNavButtons();

            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }

            if (activeElement) {
                activeElement.classList.add('active');
                // If it's a submenu item, also activate its parent button
                const parentSubmenu = activeElement.closest('.submenu');
                if (parentSubmenu) {
                    const parentButton = document.querySelector(`.nav-menu-button[data-target="${parentSubmenu.id}"]`);
                    if (parentButton) {
                        parentButton.classList.add('active');
                    }
                }
            }
        }

        // Event Listeners for Navigation Buttons
        navButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const targetSubmenuId = button.dataset.target;
                if (targetSubmenuId) {
                    const targetSubmenu = document.getElementById(targetSubmenuId);
                    if (targetSubmenu) {
                        hideAllSubmenus(); // Hide others before showing this one
                        targetSubmenu.classList.toggle('active');
                        deactivateAllNavButtons(); // Deactivate all nav buttons
                        button.classList.add('active'); // Activate current button
                    }
                } else if (button.id === 'navHomeButton') {
                    showSection('homeSection', button);
                }
            });
        });

        // Event Listeners for Submenu Items
        submenuItems.forEach(item => {
            item.addEventListener('click', (event) => {
                const sectionIdMap = {
                    'navCourses': 'coursesSection',
                    'navStudents': 'studentsSection',
                    'navTeachers': 'teachersSection',
                    'navCourseOfferings': 'courseOfferingsSection',
                    'navRoutine': 'routineSection',
                    'navAttendance': 'attendanceSection',
                    'navHolidays': 'holidaysSection',
                    'navAcademicCalendar': 'academicCalendarSection',
                    'navAddRemove': 'addRemoveSection',
                    'navDragDropRoutine': 'dragDropRoutineSection'
                };
                const targetSectionId = sectionIdMap[item.id];
                if (targetSectionId) {
                    showSection(targetSectionId, item);
                    // Specific refresh functions for sections
                    if (item.id === 'navCourses') displayCourses();
                    if (item.id === 'navStudents') displayStudents();
                    if (item.id === 'navTeachers') displayTeachers();
                    if (item.id === 'navCourseOfferings') displayCourseOfferings();
                    if (item.id === 'navRoutine') displayRoutine();
                    if (item.id === 'navAttendance') populateAttendanceCourseSelect();
                    if (item.id === 'navHolidays') displayHolidaysEvents();
                    if (item.id === 'navAddRemove') {
                        populateCourseFacultySelect();
                        populateRoutineCourseSelect();
                        populateAvailableCoursesForOffering();
                        displayCourses();
                        displayCourseOfferings();
                        displayStudents();
                        displayTeachers();
                        displayRoutine();
                        displayHolidaysEvents();
                    }
                    if (item.id === 'navDragDropRoutine') {
                        renderDragDropRoutineGrid();
                        populateDragCoursesList();
                    }
                }
            });
        });

        // Close submenu when clicking outside
        document.addEventListener('click', (event) => {
            if (!event.target.closest('.nav-menu-item')) {
                hideAllSubmenus();
            }
        });

        // --- Tab Logic for Add/Remove Section ---
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab;

                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                button.classList.add('active');
                document.getElementById(tabId + 'Tab').classList.add('active');
            });
        });

        // --- Course Management ---
        const addCourseForm = document.getElementById('addCourseForm');
        const coursesListDiv = document.getElementById('coursesList');
        let editingCourseId = null;

        /**
         * Renders the list of courses.
         */
        function displayCourses() {
            if (courses.length === 0) {
                coursesListDiv.innerHTML = '<p class="text-gray-500 text-center">No courses added yet.</p>';
                document.getElementById('displayCoursesList').innerHTML = '<p class="text-gray-500 text-center">No courses to display.</p>';
                return;
            }

            let tableHtml = `
                <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Course Code</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Course Name</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Semester</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Faculty</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Type</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Curriculum</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Offered To</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Timing</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Room</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            courses.forEach(course => {
                const faculty = teachers.find(t => t.id === course.facultyId);
                tableHtml += `
                    <tr>
                        <td class="py-3 px-4 border-b border-gray-200">${course.code}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${course.name}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${course.semester}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${faculty ? faculty.name : 'N/A'}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${course.type}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${course.curriculum}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${course.offeredToSemester}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${course.timing}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${course.room}</td>
                        <td class="py-3 px-4 border-b border-gray-200">
                            <button onclick="editCourse('${course.id}')" class="text-blue-600 hover:text-blue-900 text-sm mr-2">Edit</button>
                            <button onclick="deleteCourse('${course.id}')" class="text-red-600 hover:text-red-900 text-sm">Delete</button>
                        </td>
                    </tr>
                `;
            });
            tableHtml += `</tbody></table>`;
            coursesListDiv.innerHTML = tableHtml;
            document.getElementById('displayCoursesList').innerHTML = tableHtml;
        }

        /**
         * Populates the faculty select dropdown for courses.
         */
        function populateCourseFacultySelect() {
            const select = document.getElementById('courseFaculty');
            select.innerHTML = '<option value="">-- Select Faculty --</option>';
            teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher.id;
                option.textContent = teacher.name;
                select.appendChild(option);
            });
        }

        /**
         * Handles adding or updating a course.
         * @param {Event} event - The form submission event.
         */
        addCourseForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(addCourseForm);
            const newCourse = {
                id: editingCourseId || Date.now().toString(), // Unique ID
                name: formData.get('courseName'),
                code: formData.get('courseCode'),
                semester: formData.get('courseSemester'),
                facultyId: formData.get('courseFaculty'),
                type: formData.get('courseType'),
                curriculum: formData.get('curriculumType'),
                offeredToSemester: formData.get('offeredToSemester'),
                timing: formData.get('courseTiming'),
                room: formData.get('courseRoom')
            };

            if (editingCourseId) {
                // Update existing course
                courses = courses.map(course => course.id === editingCourseId ? newCourse : course);
                showMessageBox('Course updated successfully!');
            } else {
                // Add new course
                courses.push(newCourse);
                showMessageBox('Course added successfully!');
            }
            saveData('courses', courses);
            addCourseForm.reset();
            editingCourseId = null;
            document.getElementById('addUpdateCourseBtn').textContent = 'Add Course to Curriculum';
            document.getElementById('courseFormTitle').textContent = 'Add New Course to Curriculum';
            document.getElementById('cancelCourseEditBtn').classList.add('hidden');
            displayCourses();
            populateAvailableCoursesForOffering(); // Refresh for offerings
            populateRoutineCourseSelect(); // Refresh for routine
            populateDragCoursesList(); // Refresh for drag and drop routine
        });

        /**
         * Sets the form for editing a course.
         * @param {string} id - The ID of the course to edit.
         */
        function editCourse(id) {
            const courseToEdit = courses.find(course => course.id === id);
            if (courseToEdit) {
                document.getElementById('courseName').value = courseToEdit.name;
                document.getElementById('courseCode').value = courseToEdit.code;
                document.getElementById('courseSemester').value = courseToEdit.semester;
                document.getElementById('courseFaculty').value = courseToEdit.facultyId;
                document.getElementById('courseType').value = courseToEdit.type;
                document.getElementById('curriculumType').value = courseToEdit.curriculum;
                document.getElementById('offeredToSemester').value = courseToEdit.offeredToSemester;
                document.getElementById('courseTiming').value = courseToEdit.timing;
                document.getElementById('courseRoom').value = courseToEdit.room;

                editingCourseId = id;
                document.getElementById('addUpdateCourseBtn').textContent = 'Update Course';
                document.getElementById('courseFormTitle').textContent = 'Edit Course in Curriculum';
                document.getElementById('cancelCourseEditBtn').classList.remove('hidden');
            }
        }

        /**
         * Cancels course editing and resets the form.
         */
        document.getElementById('cancelCourseEditBtn').addEventListener('click', () => {
            addCourseForm.reset();
            editingCourseId = null;
            document.getElementById('addUpdateCourseBtn').textContent = 'Add Course to Curriculum';
            document.getElementById('courseFormTitle').textContent = 'Add New Course to Curriculum';
            document.getElementById('cancelCourseEditBtn').classList.add('hidden');
        });

        /**
         * Deletes a course.
         * @param {string} id - The ID of the course to delete.
         */
        function deleteCourse(id) {
            if (confirm('Are you sure you want to delete this course?')) {
                courses = courses.filter(course => course.id !== id);
                saveData('courses', courses);
                displayCourses();
                populateAvailableCoursesForOffering();
                populateRoutineCourseSelect();
                populateDragCoursesList();
                showMessageBox('Course deleted successfully!');
            }
        }

        // --- Course Offering Management ---
        const addCourseOfferingForm = document.getElementById('addCourseOfferingForm');
        const courseOfferingsListDiv = document.getElementById('courseOfferingsList');
        let editingOfferingId = null;

        /**
         * Populates the list of available courses for course offerings.
         */
        function populateAvailableCoursesForOffering() {
            const container = document.getElementById('availableCoursesForOffering');
            container.innerHTML = '';
            if (courses.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No courses available. Add courses to curriculum first.</p>';
                return;
            }

            courses.forEach(course => {
                const checkboxDiv = document.createElement('div');
                checkboxDiv.classList.add('flex', 'items-center');
                checkboxDiv.innerHTML = `
                    <input type="checkbox" id="offeringCourse_${course.id}" name="selectedCourses" value="${course.id}" class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                    <label for="offeringCourse_${course.id}" class="ml-2 text-gray-700 text-sm">${course.code} - ${course.name} (${course.curriculum}, ${course.offeredToSemester})</label>
                `;
                container.appendChild(checkboxDiv);
            });
        }

        /**
         * Renders the list of course offerings.
         */
        function displayCourseOfferings() {
            if (courseOfferings.length === 0) {
                courseOfferingsListDiv.innerHTML = '<p class="text-gray-500 text-center">No course offerings added yet.</p>';
                document.getElementById('displayCourseOfferingsList').innerHTML = '<p class="text-gray-500 text-center">No course offerings to display.</p>';
                return;
            }

            let tableHtml = `
                <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Offering Semester</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Offered Courses (Curriculum, Target Semester)</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            courseOfferings.forEach(offering => {
                const offeredCourseDetails = offering.courseIds.map(courseId => {
                    const course = courses.find(c => c.id === courseId);
                    return course ? `${course.code} - ${course.name} (${course.curriculum}, ${course.offeredToSemester})` : 'Unknown Course';
                }).join('<br>'); // Use <br> for better readability in a table cell

                tableHtml += `
                    <tr>
                        <td class="py-3 px-4 border-b border-gray-200">${offering.semester}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${offeredCourseDetails}</td>
                        <td class="py-3 px-4 border-b border-gray-200">
                            <button onclick="editCourseOffering('${offering.id}')" class="text-blue-600 hover:text-blue-900 text-sm mr-2">Edit</button>
                            <button onclick="deleteCourseOffering('${offering.id}')" class="text-red-600 hover:text-red-900 text-sm">Delete</button>
                        </td>
                    </tr>
                `;
            });
            tableHtml += `</tbody></table>`;
            courseOfferingsListDiv.innerHTML = tableHtml;
            document.getElementById('displayCourseOfferingsList').innerHTML = tableHtml;
        }

        /**
         * Handles adding or updating a course offering.
         * @param {Event} event - The form submission event.
         */
        addCourseOfferingForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(addCourseOfferingForm);
            const selectedCourseIds = Array.from(document.querySelectorAll('#availableCoursesForOffering input[name="selectedCourses"]:checked'))
                                            .map(checkbox => checkbox.value);

            if (selectedCourseIds.length === 0) {
                showMessageBox('Please select at least one course for the offering.');
                return;
            }

            const newOffering = {
                id: editingOfferingId || Date.now().toString(),
                semester: formData.get('offeringSemester'),
                courseIds: selectedCourseIds
            };

            if (editingOfferingId) {
                courseOfferings = courseOfferings.map(offering => offering.id === editingOfferingId ? newOffering : offering);
                showMessageBox('Course offering updated successfully!');
            } else {
                courseOfferings.push(newOffering);
                showMessageBox('Course offering added successfully!');
            }
            saveData('courseOfferings', courseOfferings);
            addCourseOfferingForm.reset();
            editingOfferingId = null;
            document.getElementById('addUpdateOfferingBtn').textContent = 'Add Course Offering';
            document.getElementById('courseOfferingFormTitle').textContent = 'Add Course Offering for Semester';
            document.getElementById('cancelOfferingEditBtn').classList.add('hidden');
            populateAvailableCoursesForOffering(); // Reset checkboxes
            displayCourseOfferings();
        });

        /**
         * Sets the form for editing a course offering.
         * @param {string} id - The ID of the course offering to edit.
         */
        function editCourseOffering(id) {
            const offeringToEdit = courseOfferings.find(offering => offering.id === id);
            if (offeringToEdit) {
                document.getElementById('offeringSemester').value = offeringToEdit.semester;
                // Uncheck all first
                document.querySelectorAll('#availableCoursesForOffering input[name="selectedCourses"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                // Check selected courses
                offeringToEdit.courseIds.forEach(courseId => {
                    const checkbox = document.getElementById(`offeringCourse_${courseId}`);
                    if (checkbox) checkbox.checked = true;
                });

                editingOfferingId = id;
                document.getElementById('addUpdateOfferingBtn').textContent = 'Update Course Offering';
                document.getElementById('courseOfferingFormTitle').textContent = 'Edit Course Offering';
                document.getElementById('cancelOfferingEditBtn').classList.remove('hidden');
            }
        }

        /**
         * Cancels course offering editing and resets the form.
         */
        document.getElementById('cancelOfferingEditBtn').addEventListener('click', () => {
            addCourseOfferingForm.reset();
            editingOfferingId = null;
            document.getElementById('addUpdateOfferingBtn').textContent = 'Add Course Offering';
            document.getElementById('courseOfferingFormTitle').textContent = 'Add Course Offering for Semester';
            document.getElementById('cancelOfferingEditBtn').classList.add('hidden');
            populateAvailableCoursesForOffering(); // Reset checkboxes
        });

        /**
         * Deletes a course offering.
         * @param {string} id - The ID of the course offering to delete.
         */
        function deleteCourseOffering(id) {
            if (confirm('Are you sure you want to delete this course offering?')) {
                courseOfferings = courseOfferings.filter(offering => offering.id !== id);
                saveData('courseOfferings', courseOfferings);
                displayCourseOfferings();
                showMessageBox('Course offering deleted successfully!');
            }
        }

        // --- Student Management ---
        const addStudentForm = document.getElementById('addStudentForm');
        const studentsListDiv = document.getElementById('studentsList');
        let editingStudentId = null;

        /**
         * Renders the list of students.
         */
        function displayStudents() {
            if (students.length === 0) {
                studentsListDiv.innerHTML = '<p class="text-gray-500 text-center">No students added yet.</p>';
                document.getElementById('displayStudentsList').innerHTML = '<p class="text-gray-500 text-center">No students to display.</p>';
                return;
            }

            let tableHtml = `
                <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Student ID</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Name</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Address</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            students.forEach(student => {
                tableHtml += `
                    <tr>
                        <td class="py-3 px-4 border-b border-gray-200">${student.id}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${student.name}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${student.address}</td>
                        <td class="py-3 px-4 border-b border-gray-200">
                            <button onclick="editStudent('${student.id}')" class="text-blue-600 hover:text-blue-900 text-sm mr-2">Edit</button>
                            <button onclick="deleteStudent('${student.id}')" class="text-red-600 hover:text-red-900 text-sm">Delete</button>
                        </td>
                    </tr>
                `;
            });
            tableHtml += `</tbody></table>`;
            studentsListDiv.innerHTML = tableHtml;
            document.getElementById('displayStudentsList').innerHTML = tableHtml;
        }

        /**
         * Handles adding or updating a student.
         * @param {Event} event - The form submission event.
         */
        addStudentForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(addStudentForm);
            const newStudent = {
                id: formData.get('studentId'), // Use student ID as unique ID
                name: formData.get('studentName'),
                address: formData.get('studentAddress')
            };

            if (editingStudentId) {
                // Update existing student
                students = students.map(student => student.id === editingStudentId ? newStudent : student);
                showMessageBox('Student updated successfully!');
            } else {
                // Add new student, check for duplicate ID
                if (students.some(s => s.id === newStudent.id)) {
                    showMessageBox('Error: Student with this ID already exists.');
                    return;
                }
                students.push(newStudent);
                showMessageBox('Student added successfully!');
            }
            saveData('students', students);
            addStudentForm.reset();
            editingStudentId = null;
            document.getElementById('addUpdateStudentBtn').textContent = 'Add Student';
            document.getElementById('studentFormTitle').textContent = 'Add New Student';
            document.getElementById('cancelStudentEditBtn').classList.add('hidden');
            displayStudents();
        });

        /**
         * Sets the form for editing a student.
         * @param {string} id - The ID of the student to edit.
         */
        function editStudent(id) {
            const studentToEdit = students.find(student => student.id === id);
            if (studentToEdit) {
                document.getElementById('studentName').value = studentToEdit.name;
                document.getElementById('studentId').value = studentToEdit.id;
                document.getElementById('studentId').disabled = true; // Prevent changing ID
                document.getElementById('studentAddress').value = studentToEdit.address;

                editingStudentId = id;
                document.getElementById('addUpdateStudentBtn').textContent = 'Update Student';
                document.getElementById('studentFormTitle').textContent = 'Edit Student';
                document.getElementById('cancelStudentEditBtn').classList.remove('hidden');
            }
        }

        /**
         * Cancels student editing and resets the form.
         */
        document.getElementById('cancelStudentEditBtn').addEventListener('click', () => {
            addStudentForm.reset();
            editingStudentId = null;
            document.getElementById('studentId').disabled = false; // Enable ID field
            document.getElementById('addUpdateStudentBtn').textContent = 'Add Student';
            document.getElementById('studentFormTitle').textContent = 'Add New Student';
            document.getElementById('cancelStudentEditBtn').classList.add('hidden');
        });

        /**
         * Deletes a student.
         * @param {string} id - The ID of the student to delete.
         */
        function deleteStudent(id) {
            if (confirm('Are you sure you want to delete this student?')) {
                students = students.filter(student => student.id !== id);
                saveData('students', students);
                displayStudents();
                showMessageBox('Student deleted successfully!');
            }
        }

        // --- Teacher Management ---
        const addTeacherForm = document.getElementById('addTeacherForm');
        const teachersListDiv = document.getElementById('teachersList');
        let editingTeacherId = null;

        /**
         * Renders the list of teachers.
         */
        function displayTeachers() {
            if (teachers.length === 0) {
                teachersListDiv.innerHTML = '<p class="text-gray-500 text-center">No teachers added yet.</p>';
                document.getElementById('displayTeachersList').innerHTML = '<p class="text-gray-500 text-center">No teachers to display.</p>';
                return;
            }

            let tableHtml = `
                <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Initials</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Name</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Type</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            teachers.forEach(teacher => {
                tableHtml += `
                    <tr>
                        <td class="py-3 px-4 border-b border-gray-200">${teacher.initials}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${teacher.name}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${teacher.type}</td>
                        <td class="py-3 px-4 border-b border-gray-200">
                            <button onclick="editTeacher('${teacher.id}')" class="text-blue-600 hover:text-blue-900 text-sm mr-2">Edit</button>
                            <button onclick="deleteTeacher('${teacher.id}')" class="text-red-600 hover:text-red-900 text-sm">Delete</button>
                        </td>
                    </tr>
                `;
            });
            tableHtml += `</tbody></table>`;
            teachersListDiv.innerHTML = tableHtml;
            document.getElementById('displayTeachersList').innerHTML = tableHtml;
        }

        /**
         * Handles adding or updating a teacher.
         * @param {Event} event - The form submission event.
         */
        addTeacherForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(addTeacherForm);
            const newTeacher = {
                id: editingTeacherId || Date.now().toString(), // Unique ID
                name: formData.get('teacherName'),
                initials: formData.get('teacherInitials').toUpperCase(),
                type: formData.get('teacherType')
            };

            if (editingTeacherId) {
                // Update existing teacher
                teachers = teachers.map(teacher => teacher.id === editingTeacherId ? newTeacher : teacher);
                showMessageBox('Teacher updated successfully!');
            } else {
                // Add new teacher
                teachers.push(newTeacher);
                showMessageBox('Teacher added successfully!');
            }
            saveData('teachers', teachers);
            addTeacherForm.reset();
            editingTeacherId = null;
            document.getElementById('addUpdateTeacherBtn').textContent = 'Add Teacher';
            document.getElementById('teacherFormTitle').textContent = 'Add New Teacher';
            document.getElementById('cancelTeacherEditBtn').classList.add('hidden');
            displayTeachers();
            populateCourseFacultySelect(); // Refresh faculty dropdown for courses
        });

        /**
         * Sets the form for editing a teacher.
         * @param {string} id - The ID of the teacher to edit.
         */
        function editTeacher(id) {
            const teacherToEdit = teachers.find(teacher => teacher.id === id);
            if (teacherToEdit) {
                document.getElementById('teacherName').value = teacherToEdit.name;
                document.getElementById('teacherInitials').value = teacherToEdit.initials;
                document.getElementById('teacherType').value = teacherToEdit.type;

                editingTeacherId = id;
                document.getElementById('addUpdateTeacherBtn').textContent = 'Update Teacher';
                document.getElementById('teacherFormTitle').textContent = 'Edit Teacher';
                document.getElementById('cancelTeacherEditBtn').classList.remove('hidden');
            }
        }

        /**
         * Cancels teacher editing and resets the form.
         */
        document.getElementById('cancelTeacherEditBtn').addEventListener('click', () => {
            addTeacherForm.reset();
            editingTeacherId = null;
            document.getElementById('addUpdateTeacherBtn').textContent = 'Add Teacher';
            document.getElementById('teacherFormTitle').textContent = 'Add New Teacher';
            document.getElementById('cancelTeacherEditBtn').classList.add('hidden');
        });

        /**
         * Deletes a teacher.
         * @param {string} id - The ID of the teacher to delete.
         */
        function deleteTeacher(id) {
            if (confirm('Are you sure you want to delete this teacher?')) {
                teachers = teachers.filter(teacher => teacher.id !== id);
                saveData('teachers', teachers);
                displayTeachers();
                populateCourseFacultySelect();
                showMessageBox('Teacher deleted successfully!');
            }
        }

        // --- Routine Management ---
        const addRoutineForm = document.getElementById('addRoutineForm');
        const routineListDiv = document.getElementById('routineList');
        let editingRoutineId = null;

        /**
         * Populates the course select dropdown for routine entries.
         */
        function populateRoutineCourseSelect() {
            const select = document.getElementById('routineCourse');
            select.innerHTML = '<option value="">-- Select Course --</option>';
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = `${course.code} - ${course.name}`;
                select.appendChild(option);
            });
        }

        /**
         * Renders the list of routine entries.
         */
        function displayRoutine() {
            if (routineEntries.length === 0) {
                routineListDiv.innerHTML = '<p class="text-gray-500 text-center">No routine entries added yet.</p>';
                document.getElementById('displayRoutineList').innerHTML = '<p class="text-gray-500 text-center">No routine entries to display.</p>';
                return;
            }

            let tableHtml = `
                <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Course</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Day</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Time</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Room</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            routineEntries.forEach(entry => {
                const course = courses.find(c => c.id === entry.courseId);
                tableHtml += `
                    <tr>
                        <td class="py-3 px-4 border-b border-gray-200">${course ? `${course.code} - ${course.name}` : 'Unknown Course'}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${entry.day}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${entry.startTime} - ${entry.endTime}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${entry.room}</td>
                        <td class="py-3 px-4 border-b border-gray-200">
                            <button onclick="editRoutineEntry('${entry.id}')" class="text-blue-600 hover:text-blue-900 text-sm mr-2">Edit</button>
                            <button onclick="deleteRoutineEntry('${entry.id}')" class="text-red-600 hover:text-red-900 text-sm">Delete</button>
                        </td>
                    </tr>
                `;
            });
            tableHtml += `</tbody></table>`;
            routineListDiv.innerHTML = tableHtml;
            document.getElementById('displayRoutineList').innerHTML = tableHtml;
        }

        /**
         * Handles adding or updating a routine entry.
         * @param {Event} event - The form submission event.
         */
        addRoutineForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(addRoutineForm);
            const newEntry = {
                id: editingRoutineId || Date.now().toString(),
                courseId: formData.get('routineCourse'),
                day: formData.get('routineDay'),
                startTime: formData.get('routineStartTime'),
                endTime: formData.get('routineEndTime'),
                room: formData.get('routineRoom')
            };

            if (editingRoutineId) {
                routineEntries = routineEntries.map(entry => entry.id === editingRoutineId ? newEntry : entry);
                showMessageBox('Routine entry updated successfully!');
            } else {
                routineEntries.push(newEntry);
                showMessageBox('Routine entry added successfully!');
            }
            saveData('routineEntries', routineEntries);
            addRoutineForm.reset();
            editingRoutineId = null;
            document.getElementById('addUpdateRoutineBtn').textContent = 'Add Routine Entry';
            document.getElementById('routineFormTitle').textContent = 'Add Routine Entry';
            document.getElementById('cancelRoutineEditBtn').classList.add('hidden');
            displayRoutine();
            renderDragDropRoutineGrid(); // Refresh drag and drop routine
        });

        /**
         * Sets the form for editing a routine entry.
         * @param {string} id - The ID of the routine entry to edit.
         */
        function editRoutineEntry(id) {
            const entryToEdit = routineEntries.find(entry => entry.id === id);
            if (entryToEdit) {
                document.getElementById('routineCourse').value = entryToEdit.courseId;
                document.getElementById('routineDay').value = entryToEdit.day;
                document.getElementById('routineStartTime').value = entryToEdit.startTime;
                document.getElementById('routineEndTime').value = entryToEdit.endTime;
                document.getElementById('routineRoom').value = entryToEdit.room;

                editingRoutineId = id;
                document.getElementById('addUpdateRoutineBtn').textContent = 'Update Routine Entry';
                document.getElementById('routineFormTitle').textContent = 'Edit Routine Entry';
                document.getElementById('cancelRoutineEditBtn').classList.remove('hidden');
            }
        }

        /**
         * Cancels routine entry editing and resets the form.
         */
        document.getElementById('cancelRoutineEditBtn').addEventListener('click', () => {
            addRoutineForm.reset();
            editingRoutineId = null;
            document.getElementById('addUpdateRoutineBtn').textContent = 'Add Routine Entry';
            document.getElementById('routineFormTitle').textContent = 'Add Routine Entry';
            document.getElementById('cancelRoutineEditBtn').classList.add('hidden');
        });

        /**
         * Deletes a routine entry.
         * @param {string} id - The ID of the routine entry to delete.
         */
        function deleteRoutineEntry(id) {
            if (confirm('Are you sure you want to delete this routine entry?')) {
                routineEntries = routineEntries.filter(entry => entry.id !== id);
                saveData('routineEntries', routineEntries);
                displayRoutine();
                renderDragDropRoutineGrid();
                showMessageBox('Routine entry deleted successfully!');
            }
        }

        // --- Holidays & Events Management ---
        const addHolidayForm = document.getElementById('addHolidayForm');
        const holidaysListDiv = document.getElementById('holidaysList');
        let editingHolidayId = null;

        /**
         * Renders the list of holidays and events.
         */
        function displayHolidaysEvents() {
            if (holidaysEvents.length === 0) {
                holidaysListDiv.innerHTML = '<p class="text-gray-500 text-center">No events added yet.</p>';
                document.getElementById('displayHolidaysList').innerHTML = '<p class="text-gray-500 text-center">No holidays or events to display.</p>';
                return;
            }

            let tableHtml = `
                <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Date</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Type</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Title</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Description</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            holidaysEvents.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(event => {
                tableHtml += `
                    <tr>
                        <td class="py-3 px-4 border-b border-gray-200">${event.date}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${event.type}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${event.title}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${event.description || 'N/A'}</td>
                        <td class="py-3 px-4 border-b border-gray-200">
                            <button onclick="editHolidayEvent('${event.id}')" class="text-blue-600 hover:text-blue-900 text-sm mr-2">Edit</button>
                            <button onclick="deleteHolidayEvent('${event.id}')" class="text-red-600 hover:text-red-900 text-sm">Delete</button>
                        </td>
                    </tr>
                `;
            });
            tableHtml += `</tbody></table>`;
            holidaysListDiv.innerHTML = tableHtml;
            document.getElementById('displayHolidaysList').innerHTML = tableHtml;
            updateHomeEvents(); // Update home section with new events
        }

        /**
         * Handles adding or updating a holiday/event.
         * @param {Event} event - The form submission event.
         */
        addHolidayForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(addHolidayForm);
            const newEvent = {
                id: editingHolidayId || Date.now().toString(),
                type: formData.get('eventType'),
                title: formData.get('eventTitle'),
                date: formData.get('eventDate'),
                description: formData.get('eventDescription')
            };

            if (editingHolidayId) {
                holidaysEvents = holidaysEvents.map(event => event.id === editingHolidayId ? newEvent : event);
                showMessageBox('Event updated successfully!');
            } else {
                holidaysEvents.push(newEvent);
                showMessageBox('Event added successfully!');
            }
            saveData('holidaysEvents', holidaysEvents);
            addHolidayForm.reset();
            editingHolidayId = null;
            document.getElementById('addUpdateHolidayBtn').textContent = 'Add Event';
            document.getElementById('holidayFormTitle').textContent = 'Add New Event';
            document.getElementById('cancelHolidayEditBtn').classList.add('hidden');
            displayHolidaysEvents();
        });

        /**
         * Sets the form for editing a holiday/event.
         * @param {string} id - The ID of the holiday/event to edit.
         */
        function editHolidayEvent(id) {
            const eventToEdit = holidaysEvents.find(event => event.id === id);
            if (eventToEdit) {
                document.getElementById('eventType').value = eventToEdit.type;
                document.getElementById('eventTitle').value = eventToEdit.title;
                document.getElementById('eventDate').value = eventToEdit.date;
                document.getElementById('eventDescription').value = eventToEdit.description;

                editingHolidayId = id;
                document.getElementById('addUpdateHolidayBtn').textContent = 'Update Event';
                document.getElementById('holidayFormTitle').textContent = 'Edit Event';
                document.getElementById('cancelHolidayEditBtn').classList.remove('hidden');
            }
        }

        /**
         * Cancels holiday/event editing and resets the form.
         */
        document.getElementById('cancelHolidayEditBtn').addEventListener('click', () => {
            addHolidayForm.reset();
            editingHolidayId = null;
            document.getElementById('addUpdateHolidayBtn').textContent = 'Add Event';
            document.getElementById('holidayFormTitle').textContent = 'Add New Event';
            document.getElementById('cancelHolidayEditBtn').classList.add('hidden');
        });

        /**
         * Deletes a holiday/event.
         * @param {string} id - The ID of the holiday/event to delete.
         */
        function deleteHolidayEvent(id) {
            if (confirm('Are you sure you want to delete this event?')) {
                holidaysEvents = holidaysEvents.filter(event => event.id !== id);
                saveData('holidaysEvents', holidaysEvents);
                displayHolidaysEvents();
                showMessageBox('Event deleted successfully!');
            }
        }

        // --- Home Section Events Display ---
        /**
         * Updates the "Today's Events" and "Upcoming Events" lists on the home page.
         */
        function updateHomeEvents() {
            const todayEventsList = document.getElementById('todayEventsList');
            const upcomingEventsList = document.getElementById('upcomingEventsList');
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Normalize to start of day

            todayEventsList.innerHTML = '';
            upcomingEventsList.innerHTML = '';

            let hasTodayEvents = false;
            let hasUpcomingEvents = false;

            holidaysEvents.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(event => {
                const eventDate = new Date(event.date);
                eventDate.setHours(0, 0, 0, 0);

                if (eventDate.getTime() === today.getTime()) {
                    todayEventsList.innerHTML += `<p class="text-gray-700"><strong>${event.type}:</strong> ${event.title} (${event.description || 'No description'})</p>`;
                    hasTodayEvents = true;
                } else if (eventDate > today && (eventDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24) <= 7) {
                    upcomingEventsList.innerHTML += `<p class="text-gray-700"><strong>${event.date} - ${event.type}:</strong> ${event.title} (${event.description || 'No description'})</p>`;
                    hasUpcomingEvents = true;
                }
            });

            if (!hasTodayEvents) {
                todayEventsList.innerHTML = '<p class="text-gray-500">No events scheduled for today.</p>';
            }
            if (!hasUpcomingEvents) {
                upcomingEventsList.innerHTML = '<p class="text-gray-500">No upcoming events.</p>';
            }
        }

        // --- Attendance Sheet Management ---
        const attendanceCourseSelect = document.getElementById('attendanceCourseSelect');
        const attendanceDateInput = document.getElementById('attendanceDate');
        const loadAttendanceBtn = document.getElementById('loadAttendanceBtn');
        const attendanceSheetDisplay = document.getElementById('attendanceSheetDisplay');
        const attendanceCourseTitle = document.getElementById('attendanceCourseTitle');
        const attendanceDateDisplay = document.getElementById('attendanceDateDisplay');
        const attendanceTableContainer = document.getElementById('attendanceTableContainer');
        const saveAttendanceBtn = document.getElementById('saveAttendanceBtn');

        /**
         * Populates the course select dropdown for attendance.
         */
        function populateAttendanceCourseSelect() {
            attendanceCourseSelect.innerHTML = '<option value="">-- Select Course --</option>';
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = `${course.code} - ${course.name}`;
                attendanceCourseSelect.appendChild(option);
            });
        }

        /**
         * Loads the attendance sheet for a selected course and date.
         */
        loadAttendanceBtn.addEventListener('click', () => {
            const courseId = attendanceCourseSelect.value;
            const date = attendanceDateInput.value;

            if (!courseId || !date) {
                showMessageBox('Please select a course and a date.');
                return;
            }

            const selectedCourse = courses.find(c => c.id === courseId);
            if (!selectedCourse) {
                showMessageBox('Selected course not found.');
                return;
            }

            attendanceCourseTitle.textContent = `${selectedCourse.code} - ${selectedCourse.name}`;
            attendanceDateDisplay.textContent = date;
            attendanceSheetDisplay.classList.remove('hidden');

            const attendanceKey = `${courseId}_${date}`;
            const currentAttendance = attendanceRecords[attendanceKey] || {};

            let tableHtml = `
                <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Student ID</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Student Name</th>
                            <th class="py-3 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            if (students.length === 0) {
                tableHtml += `<tr><td colspan="3" class="py-3 px-4 text-center text-gray-500">No students registered.</td></tr>`;
            } else {
                students.forEach(student => {
                    const status = currentAttendance[student.id] || 'present'; // Default to present
                    tableHtml += `
                        <tr>
                            <td class="py-3 px-4 border-b border-gray-200">${student.id}</td>
                            <td class="py-3 px-4 border-b border-gray-200">${student.name}</td>
                            <td class="py-3 px-4 border-b border-gray-200">
                                <select data-student-id="${student.id}" class="attendance-status focus:ring-red-500 focus:border-red-500">
                                    <option value="present" ${status === 'present' ? 'selected' : ''}>Present</option>
                                    <option value="absent" ${status === 'absent' ? 'selected' : ''}>Absent</option>
                                    <option value="late" ${status === 'late' ? 'selected' : ''}>Late</option>
                                </select>
                            </td>
                        </tr>
                    `;
                });
            }
            tableHtml += `</tbody></table>`;
            attendanceTableContainer.innerHTML = tableHtml;
        });

        /**
         * Saves the attendance records.
         */
        saveAttendanceBtn.addEventListener('click', () => {
            const courseId = attendanceCourseSelect.value;
            const date = attendanceDateInput.value;

            if (!courseId || !date) {
                showMessageBox('Cannot save: Course or date not selected.');
                return;
            }

            const attendanceKey = `${courseId}_${date}`;
            const newAttendance = {};

            document.querySelectorAll('.attendance-status').forEach(select => {
                const studentId = select.dataset.studentId;
                newAttendance[studentId] = select.value;
            });

            attendanceRecords[attendanceKey] = newAttendance;
            saveData('attendanceRecords', attendanceRecords);
            showMessageBox('Attendance saved successfully!');
        });

        // --- Drag & Drop Routine Maker ---
        const dragCoursesList = document.getElementById('dragCoursesList');
        const dragDropRoutineGrid = document.getElementById('dragDropRoutineGrid').getElementsByTagName('tbody')[0];
        const saveRoutineGridBtn = document.getElementById('saveRoutineGridBtn');
        const clashReport = document.getElementById('clashReport');
        const clashReportList = document.getElementById('clashReportList');

        let draggedCourseData = null; // Stores data of the course being dragged

        const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const timeSlots = [
            "08:00-09:00", "09:00-10:00", "10:00-11:00", "11:00-12:00",
            "12:00-13:00", "13:00-14:00", "14:00-15:00", "15:00-16:00",
            "16:00-17:00", "17:00-18:00"
        ];

        /**
         * Populates the list of draggable courses.
         */
        function populateDragCoursesList() {
            dragCoursesList.innerHTML = '';
            if (courses.length === 0) {
                dragCoursesList.innerHTML = '<p class="text-gray-500">No courses available for drag & drop. Add courses first.</p>';
                return;
            }

            courses.forEach(course => {
                const courseDiv = document.createElement('div');
                courseDiv.classList.add('draggable-course');
                courseDiv.setAttribute('draggable', 'true');
                courseDiv.dataset.courseId = course.id;
                courseDiv.textContent = `${course.code} - ${course.name}`;
                dragCoursesList.appendChild(courseDiv);
            });

            addDragEventListeners();
        }

        /**
         * Adds drag event listeners to draggable courses.
         */
        function addDragEventListeners() {
            document.querySelectorAll('.draggable-course').forEach(draggable => {
                draggable.addEventListener('dragstart', (e) => {
                    e.target.classList.add('dragging');
                    const courseId = e.target.dataset.courseId;
                    draggedCourseData = courses.find(c => c.id === courseId);
                    e.dataTransfer.setData('text/plain', courseId); // Set data for drop
                });

                draggable.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                    draggedCourseData = null;
                });
            });
        }

        /**
         * Renders the drag and drop routine grid.
         */
        function renderDragDropRoutineGrid() {
            dragDropRoutineGrid.innerHTML = ''; // Clear existing rows

            timeSlots.forEach(timeSlot => {
                const row = dragDropRoutineGrid.insertRow();
                const timeCell = row.insertCell();
                timeCell.classList.add('time-slot-header');
                timeCell.textContent = timeSlot;

                daysOfWeek.forEach(day => {
                    const cell = row.insertCell();
                    cell.classList.add('drop-target');
                    cell.dataset.day = day;
                    cell.dataset.timeSlot = timeSlot;

                    // Add existing routine entries to the grid
                    const entriesInSlot = routineEntries.filter(entry =>
                        entry.day === day &&
                        isTimeOverlap(entry.startTime, entry.endTime, timeSlot.split('-')[0], timeSlot.split('-')[1])
                    );

                    entriesInSlot.forEach(entry => {
                        const course = courses.find(c => c.id === entry.courseId);
                        if (course) {
                            const routineItem = createRoutineItem(entry.id, course.code, course.name, entry.room);
                            cell.appendChild(routineItem);
                        }
                    });
                });
            });

            addDropEventListeners();
            checkClashes();
        }

        /**
         * Creates a routine item element for the grid.
         * @param {string} entryId - The ID of the routine entry.
         * @param {string} courseCode - The code of the course.
         * @param {string} courseName - The name of the course.
         * @param {string} room - The room number.
         * @returns {HTMLElement} The routine item element.
         */
        function createRoutineItem(entryId, courseCode, courseName, room) {
            const routineItem = document.createElement('div');
            routineItem.classList.add('routine-item');
            routineItem.dataset.entryId = entryId;
            routineItem.innerHTML = `
                <span>${courseCode} (${room})</span>
                <button class="delete-btn" title="Remove">&times;</button>
            `;
            routineItem.querySelector('.delete-btn').addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent drop event from firing
                deleteRoutineEntryFromGrid(entryId);
            });
            return routineItem;
        }

        /**
         * Adds drop event listeners to grid cells.
         */
        function addDropEventListeners() {
            document.querySelectorAll('.drop-target').forEach(cell => {
                cell.addEventListener('dragover', (e) => {
                    e.preventDefault(); // Allow drop
                    cell.classList.add('drag-over');
                });

                cell.addEventListener('dragleave', () => {
                    cell.classList.remove('drag-over');
                });

                cell.addEventListener('drop', (e) => {
                    e.preventDefault();
                    cell.classList.remove('drag-over');

                    if (draggedCourseData) {
                        const day = cell.dataset.day;
                        const timeSlot = cell.dataset.timeSlot;
                        const [startTime, endTime] = timeSlot.split('-');

                        // Check for existing course in this slot
                        const existingItem = cell.querySelector('.routine-item');
                        if (existingItem) {
                            showMessageBox('A course already exists in this slot. Please remove it first.');
                            return;
                        }

                        // Add new routine entry
                        const newEntry = {
                            id: Date.now().toString(), // Unique ID for this routine instance
                            courseId: draggedCourseData.id,
                            day: day,
                            startTime: startTime,
                            endTime: endTime,
                            room: draggedCourseData.room || 'N/A' // Use default room from course or 'N/A'
                        };

                        routineEntries.push(newEntry);
                        saveData('routineEntries', routineEntries);
                        renderDragDropRoutineGrid(); // Re-render to update grid and check clashes
                        showMessageBox('Course added to routine!');
                    }
                });
            });
        }

        /**
         * Deletes a routine entry from the grid and data.
         * @param {string} entryId - The ID of the routine entry to delete.
         */
        function deleteRoutineEntryFromGrid(entryId) {
            if (confirm('Are you sure you want to remove this course from the routine?')) {
                routineEntries = routineEntries.filter(entry => entry.id !== entryId);
                saveData('routineEntries', routineEntries);
                renderDragDropRoutineGrid();
                showMessageBox('Course removed from routine.');
            }
        }

        /**
         * Checks for time overlaps between two time ranges.
         * @param {string} start1 - Start time of range 1 (HH:MM).
         * @param {string} end1 - End time of range 1 (HH:MM).
         * @param {string} start2 - Start time of range 2 (HH:MM).
         * @param {string} end2 - End time of range 2 (HH:MM).
         * @returns {boolean} True if there is an overlap, false otherwise.
         */
        function isTimeOverlap(start1, end1, start2, end2) {
            const parseTime = (timeStr) => {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            };

            const s1 = parseTime(start1);
            const e1 = parseTime(end1);
            const s2 = parseTime(start2);
            const e2 = parseTime(end2);

            return Math.max(s1, s2) < Math.min(e1, e2);
        }

        /**
         * Checks for clashes in the routine and displays a report.
         */
        function checkClashes() {
            clashReportList.innerHTML = '';
            clashReport.classList.add('hidden');
            let hasClashes = false;

            const clashes = [];

            // Group entries by day
            const routineByDay = daysOfWeek.reduce((acc, day) => {
                acc[day] = routineEntries.filter(entry => entry.day === day);
                return acc;
            }, {});

            for (const day in routineByDay) {
                const entriesForDay = routineByDay[day];
                for (let i = 0; i < entriesForDay.length; i++) {
                    for (let j = i + 1; j < entriesForDay.length; j++) {
                        const entry1 = entriesForDay[i];
                        const entry2 = entriesForDay[j];

                        if (isTimeOverlap(entry1.startTime, entry1.endTime, entry2.startTime, entry2.endTime)) {
                            const course1 = courses.find(c => c.id === entry1.courseId);
                            const course2 = courses.find(c => c.id === entry2.courseId);

                            clashes.push({
                                day: day,
                                entry1: course1 ? `${course1.code} (${entry1.startTime}-${entry1.endTime}) in ${entry1.room}` : `Unknown Course (${entry1.startTime}-${entry1.endTime})`,
                                entry2: course2 ? `${course2.code} (${entry2.startTime}-${entry2.endTime}) in ${entry2.room}` : `Unknown Course (${entry2.startTime}-${entry2.endTime})`
                            });
                            hasClashes = true;
                        }
                    }
                }
            }

            if (hasClashes) {
                clashReport.classList.remove('hidden');
                clashes.forEach(clash => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<strong>${clash.day}:</strong> Clash between ${clash.entry1} and ${clash.entry2}.`;
                    clashReportList.appendChild(listItem);
                });
                const solutionItem = document.createElement('li');
                solutionItem.classList.add('solution');
                solutionItem.textContent = 'Solution: Adjust times or rooms for conflicting courses.';
                clashReportList.appendChild(solutionItem);
            }
        }

        /**
         * Saves the current state of the drag & drop routine to routineEntries.
         * This function is more for a "snapshot" of the current grid, as individual drops already update `routineEntries`.
         * It primarily triggers a re-render and clash check.
         */
        saveRoutineGridBtn.addEventListener('click', () => {
            // The routineEntries array is already updated on each successful drop.
            // This button primarily serves to re-check clashes and confirm save.
            saveData('routineEntries', routineEntries);
            renderDragDropRoutineGrid(); // Re-render to ensure consistency and re-check clashes
            showMessageBox('Routine saved successfully!');
        });

        // --- Login/Logout Logic ---
        const loginForm = document.getElementById('loginForm');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginError = document.getElementById('loginError');
        const loginSection = document.getElementById('loginSection');
        const mainContent = document.getElementById('mainContent');
        const logoutButton = document.getElementById('logoutButton');

        loginForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const username = usernameInput.value;
            const password = passwordInput.value;

            // Hardcoded credentials
            const correctUsername = 'admnell';
            const correctPassword = '@420IN3ll';

            if (username === correctUsername && password === correctPassword) {
                loginSection.classList.add('hidden');
                mainContent.classList.remove('hidden');
                loginError.classList.add('hidden');
                // Initialize the app after successful login
                initializeApp();
            } else {
                loginError.classList.remove('hidden');
            }
        });

        /**
         * Handles the logout process.
         */
        logoutButton.addEventListener('click', () => {
            mainContent.classList.add('hidden');
            loginSection.classList.remove('hidden');
            usernameInput.value = ''; // Clear username field
            passwordInput.value = ''; // Clear password field
            loginError.classList.add('hidden'); // Hide any previous login errors
            showMessageBox('Logged out successfully.');
        });


        // --- Initial App Load ---
        /**
         * Initializes the application by displaying relevant data.
         */
        function initializeApp() {
            showLoading();
            // Load data from localStorage (already done at the top, but good to re-emphasize)
            courses = JSON.parse(localStorage.getItem('courses')) || [];
            students = JSON.parse(localStorage.getItem('students')) || [];
            teachers = JSON.parse(localStorage.getItem('teachers')) || [];
            courseOfferings = JSON.parse(localStorage.getItem('courseOfferings')) || [];
            routineEntries = JSON.parse(localStorage.getItem('routineEntries')) || [];
            holidaysEvents = JSON.parse(localStorage.getItem('holidaysEvents')) || [];
            attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords')) || {};

            // Set initial active section to Home
            showSection('homeSection', document.getElementById('navHomeButton'));

            // Populate dropdowns and display lists
            populateCourseFacultySelect();
            populateRoutineCourseSelect();
            populateAvailableCoursesForOffering();
            populateAttendanceCourseSelect();
            populateDragCoursesList();
            renderDragDropRoutineGrid(); // Render the routine grid on load

            // Display initial lists
            displayCourses();
            displayCourseOfferings();
            displayStudents();
            displayTeachers();
            displayRoutine();
            displayHolidaysEvents();
            updateHomeEvents();

            hideLoading();
        }

        // Event listener for the message box close button
        document.getElementById('messageBoxClose').addEventListener('click', hideMessageBox);

        // Initially hide the main content until login
        document.addEventListener('DOMContentLoaded', () => {
            loginSection.classList.remove('hidden');
            mainContent.classList.add('hidden');
        });

    </script>
</body>
</html>
